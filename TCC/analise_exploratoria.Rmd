---
title: "Análise Exploratória da PNS 2019"
author: "Eduardo Freire, Marina Mangini"
date: "2023-09-10"
output: html_document
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE)
```

```{r}
library(PNSIBGE)
tipo_de_parto_vars <- c("C008", "C009", "C011", "C01001", "C10A", "C013","C014",
    "I00102", "I00404",
    "Q00201","Q00202", "Q03001", "Q03002",
    "R032", "R037",
    "S065","S066", "S068","S070", "S073", "S074","S080","S111","S112","S113", "S114",
    "S115","S116","S11801","S125","S128","S129", "S06701",  "S06702",  "S06703",
    "V0026","V0001", "VDF004", "V00291", "VDD004A",
    "W00103", "W00203")

pns2019 <- get_pns(
   year=2019, 
   vars=tipo_de_parto_vars,
   selected=FALSE, 
   anthropometry=FALSE, 
   labels=TRUE, 
   deflator=TRUE, 
   design=TRUE, 
   savedir=tempdir()
 )
save(pns2019, file="pns2019.Rdata")
```


```{r}
load("pns2019.Rdata")
```


```{r}
library(dplyr)
library(ggplot2)
library(kableExtra)
library(survey)
### Critérios para a subamostra
# S065 == 'Sim'
# S068 == 'Sim'
pns2019$variables$S115=droplevels(pns2019$variables$S115)
```


```{r}
gera_tabela <- function(variavel, ordem_label=NULL){
  media = svyby(~S115, variavel , subset(pns2019,S068 %in% "Sim"), na.rm=TRUE, FUN=svymean, vartype="cv")
  total = svyby(~S115, variavel, subset(pns2019,S068 %in% "Sim"), na.rm=TRUE, FUN=svytotal, vartype="cv")[,1:3]
  names(media) = c("label", "Média - Vaginal", "Média - Cesariana", "CV - Vaginal", "CV - Cesariana")
  names(total) = c("label", "Total - Vaginal", "Total - Cesariana")
  media[,2:ncol(media)] = round(100*media[,2:ncol(media)], 1)
  media = data.frame(left_join(media, total , by="label"), row.names = media$label)
  kbl(media[,2:ncol(media)], booktabs = T) %>%
      kable_styling(latex_options = "striped")
}
```

#### Recomendações 

- Justificar porque escolhemos apenas parto vaginal para parto humanizado.

- Cruzar a variável motivo de ter feito a cesárea e renda.

- CV passou de 15 já ver se faz sentido juntar a categoria. Ver a tabelinha no TCC da Esther e da Pamela.


# Variáveis sociodemográficas da mulher 

Abaixo comparamos variáveis sociodemográficas com a escolha do tipo de parto(S115).

## C008	- Idade do morador na data de referência

### Boxplot

```{r}
svyboxplot(formula=C008~S115, design=subset(pns2019,S068 %in% "Sim"), main="Distribuição da idade dos respondentes em anos", ylab="Idade")
```

### Tabela

```{r}
pns2019$variables$idade = ifelse(pns2019$variables$C008 %in% c(18:24),"18-24 anos",
                    ifelse(pns2019$variables$C008 %in% c(25:32),"25-32 anos",
                    ifelse(pns2019$variables$C008 %in% c(33:40),"35-40 anos",
                    "40+ anos")))
gera_tabela(~idade)
```


## C009 - Cor ou raça

```{r}
pns2019$variables$cor=ifelse(pns2019$variables$C009 %in% c("Amarela", "Indígena"), "Amarelas e Indígenas", 
                             ifelse(pns2019$variables$C009 == "Branca", "Branca",
                            ifelse(pns2019$variables$C009 == "Preta", "Preta",
                            ifelse(pns2019$variables$C009 == "Parda", "Parda", "Ignorado"))))
gera_tabela(~cor)
```

## VDD004A - Escolaridade

```{r}
pns2019$variables$escolaridade=ifelse(pns2019$variables$VDD004A %in% c("Sem instrução", "Fundamental incompleto ou equivalente"), "Sem instrução", 
                             ifelse(pns2019$variables$VDD004A %in% c("Fundamental completo ou equivalente", "Médio incompleto ou equivalente"), "Fundamental completo ou equivalente",
                            ifelse(pns2019$variables$VDD004A %in% c("Superior incompleto ou equivalente", "Médio completo ou equivalente"), "Médio completo ou equivalente",
                            ifelse(pns2019$variables$VDD004A == "Superior completo", "Superior completo ou mais", "Ignorado"))))
gera_tabela(~escolaridade)
```

## C01001 - Cônjuge ou companheiro(a) mora em nesse domicílio.

```{r}
gera_tabela(~C01001)
```

## C013 - Cônjuge ou companheiro(a) mora em outro domicílio.

Criar regra com outra variável para ver se conjuge mora em outro domicílio e se nao tem conjuge ou outro companheiro.

```{r}
gera_tabela(~C013)
```

## Tem cônjuge ou companheiro(a)

```{r}
pns2019$variables$conjuge = ifelse((pns2019$variables$C01001 == "Sim") | (pns2019$variables$C013 == "Sim"),"Sim", "Não")
gera_tabela(~conjuge)
```

## V0001 - Unidade da Federação

```{r}
pns2019$variables$regiao=ifelse(pns2019$variables$V0001 %in% c("Acre","Amazonas","Roraima","Pará","Amapá","Tocantins"),"Norte",
                                ifelse(pns2019$variables$V0001 %in% c("Maranhão","Piauí","Ceará","Rio Grande do Norte","Paraíba","Pernambuco","Alagoas","Sergipe","Bahia"),"Nordeste",
                                       ifelse(pns2019$variables$V0001 %in% c("Minas Gerais","Espírito Santo","Rio de Janeiro","São Paulo"),"Sudeste",
                                              ifelse(pns2019$variables$V0001 %in% c("Paraná","Santa Catarina","Rio Grande do Sul"), "Sul","Centro-Oeste"))))
gera_tabela(~regiao)
```


## V0026 - Tipo de situação censitária

```{r}
gera_tabela(~V0026)
```


## VDF004	- Faixa de rendimento domiciliar per capita (exclusive o rendimento das pessoas cuja condição na  unidade domiciliar era pensionista, empregado doméstico ou parente do empregado doméstico)"

```{r}
pns2019$variables$renda=ifelse(pns2019$variables$VDF004 %in% c("Até ¼ salário mínimo", "Mais de ¼ até ½ salário mínimo"), "Até  ½ salário mínimo", 
                             ifelse(pns2019$variables$VDF004 %in% c("Mais de ½ até 1 salário mínimo", "Mais de 1 até 2 salários mínimos"), "Mais de ½ até 2 salários mínimos",
                            ifelse(pns2019$variables$VDF004 %in% c("Mais de 2 até 3 salários mínimos", "Mais de 3 até 5 salários mínimos"), "Mais de 2 até 5 salários mínimos", 
                            ifelse(pns2019$variables$VDF004 == "Mais de 5 salários mínimos", "Mais 5 salários mínimos", "Ignorado"))))
gera_tabela(~renda)
```

# Sistema de saúde

## I00102 -	tem algum plano de saúde médico particular, de empresa ou órgão público?

```{r}
gera_tabela(~I00102)
```

## S111 -	Quem fez o parto?

Cruzar I00102 e S111.

```{r}
pns2019$variables$quem_fez_parto=ifelse(pns2019$variables$S111 == "Médico (a)", "Médico (a)", "Outros")
gera_tabela(~quem_fez_parto)
```

## S112	- Onde foi realizado o parto?

Testar outras agregações(Hospital, não hospital)

```{r}
pns2019$variables$local=ifelse(pns2019$variables$S112 %in% c(
  "UPA (Unidade de Pronto Atendimento), outro tipo de pronto atendimento público (24 horas), pronto-socorro ou emergência de hospital público.\n	",
  "Hospital público ou maternidade pública", "Pronto-atendimento ou emergência de hospital privado\n"), "Ambiente hospitalar", 
                             ifelse(pns2019$variables$S112 %in% c(
                               "Casa de parto",
                               "Consultório particular, clínica privada ou ambulatório de hospital privado.",
                               "Unidade básica de saúde (posto ou centro de saúde ou unidade de saúde da família).	", 
  "Policlínica pública, PAM (Posto de Assistência Médica) ou Centro de Especialidades público"), 
                               "Clínica, consultório, posto de saúde, ambulatório ou similares", "Outros"))
gera_tabela(~local)
``` 

## S113 - Pagou algum valor pelo parto?

Cruzar S113 e S114

svyby(~S115, ~S113 + S114, subset(pns2019,S068 %in% "Sim"), na.rm=TRUE, FUN=svytotal, vartype="cv")

```{r}
gera_tabela(~S113)
```

## S114	- O parto foi feito através do Sistema Único de Saúde (SUS)?

```{r}
gera_tabela(~S114)
```

## S128	- O parto foi realizado no estabelecimento de saúde indicado no pré-natal?

Cruzar S112 com a S128

svyby(~S115, ~S113 + S114, subset(pns2019,S068 %in% "Sim"), na.rm=TRUE, FUN=svytotal, vartype="cv")

```
sum(pns2019$variables$S113 %in% 'Sim' & pns2019$variables$S114 %in% 'Sim' & pns2019$variables$S115 %in% 'Parto normal/vaginal')
```

```{r}
gera_tabela(~S128)
```

# Estado de saúde da mulher

## Q00201	- Algum médico já lhe deu o diagnóstico de hipertensão arterial (pressão alta)?

```{r}
gera_tabela(~Q00201)
```

## Q03001 - Algum médico já lhe deu o diagnóstico de diabetes?

```{r}
gera_tabela(~Q03001)
```

## R032 - Nos últimos 12 meses, a sra participou de grupo de planejamento familiar?

```{r}
gera_tabela(~R032)
```

## R037 - A sra e/ou seu companheiro já fizeram ou fazem algum tratamento para engravidar?

```{r}
gera_tabela(~R037)
```

## S066 - Quantos partos a Sra já teve?

```{r}
pns2019$variables$quantos_partos=ifelse(pns2019$variables$S066 == '1', '1',
                                ifelse(pns2019$variables$S066 == '2', '2', "3 ou mais"))
gera_tabela(~quantos_partos)
```

## S070 - Quantas consultas de pré-natal fez durante esta gravidez?

```{r}
pns2019$variables$quantos_prenatal=ifelse(pns2019$variables$S070 %in% c('Uma', 'Duas', 'Três', 'Quatro', 'Cinco'), 'menos de 6',
                                ifelse(pns2019$variables$S070 == 'Seis', '6',
                                ifelse(pns2019$variables$S070 == 'Sete ou mais', 'Mais de 6',"Não sabe \\\\ Não lembra")))
gera_tabela(~quantos_prenatal)
```

## S073 - "As consultas do pré-natal foram feitas através do Sistema Único de Saúde (SUS)?"

```{r}
gera_tabela(~S073)
```

## S074 - Nesta gravidez, quem a atendeu na maioria das consultas?

- Olhar a distribuição e ver se é necessário agregar os dois últimos

```{r}
pns2019$variables$atendimento=ifelse(pns2019$variables$S111 == "Médico (a)", "Médico (a)", 
                             ifelse(pns2019$variables$S111 == "Enfermeiro (a)", "Enfermeiro (a)", "Outro (a) profissional de saúde"))
gera_tabela(~atendimento)
```

## S080 - Durante o pré-natal de (nome) foi realizado teste∕ exame para sífilis? 

```{r}
gera_tabela(~S080)
```

## S11801 - Quantas semanas de gravidez tinha no momento do parto?

```{r}
pns2019$variables$semanas=ifelse(pns2019$variables$S11801 %in% c(0:38) , "até 38 semanas", 
                             ifelse(pns2019$variables$S11801 %in% c(39:42), "de 39 até 42 semanas",  "Mais de 42 semanas"))
gera_tabela(~semanas)
```

## S125 - Teve alguma complicação durante o parto?

```{r}
gera_tabela(~S125)
```

## Diagnósticos

- Procurar diagnóstico de obesidade na PNS
- Criar índice como número de diagnósticos ou hábitos(fumar, beber), por exemplo.
- Contar quantas dessas doenças há diagnóstico e dividir em categorias.

# Modelagem

- Testar interações entre variáveis

## Escrita

- Explicar com referências a importância de cada variável 




